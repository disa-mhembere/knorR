UNAME_S := $(shell uname -s)

ifeq ($(UNAME_S), Linux)
    PKG_CFLAGS=-DUSING_R -I. -Ilibauto -Ilibman -Ilibkcommon \
                -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -DNDEBUG -DBOOST_LOG_DYN_LINK -DUSE_HWLOC \
               -DUSE_NUMA -fopenmp \
               -DPACKAGE_VERSION=\"@VERSION@\"
    PKG_CXXFLAGS= -DUSING_R -I. -Ilibauto -Ilibman -Ilibkcommon \
                  -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -DNDEBUG -DBOOST_LOG_DYN_LINK \
                 -DUSE_HWLOC -DUSE_NUMA -fopenmp -DLINUX \
                 -DPACKAGE_VERSION=\"@VERSION@\" -std=gnu++11
    PKG_LIBS=-lpthread -lhwloc -lnuma -lboost_log
else
    PKG_CFLAGS=-DUSING_R -I. -Ilibman -Ilibkcommon \
                -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -DNDEBUG -DBOOST_LOG_DYN_LINK \
               -DPACKAGE_VERSION=\"@VERSION@\"
    PKG_CXXFLAGS=-DUSING_R -I. -Ilibman -Ilibkcommon \
                  -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -DNDEBUG -DBOOST_LOG_DYN_LINK \
                 -DPACKAGE_VERSION=\"@VERSION@\" -std=gnu++11 \
                 -I/usr/local/opt/boost/include -DOSX
    PKG_LIBS=-lpthread -lboost_log-mt -lboost_system \
				-L/usr/local/opt/boost/lib
endif

all: $(SHLIB)

OBJECTS=rinterface.o libman/base_kmeans_thread.o libkcommon/thd_safe_bool_vector.o libkcommon/util.o libman/base_kmeans_coordinator.o libman/kmeans_coordinator.o libman/kmeans_task_coordinator.o libkcommon/clusters.o libman/kmeans_task_thread.o libkcommon/dist_matrix.o libman/kmeans_thread.o libkcommon/io.o libkcommon/kmeans_types.o libkcommon/prune_stats.o

ifeq ($(UNAME_S), Linux)
	OBJECTS += libauto/kmeans.o libauto/min-tri-kmeans.o
endif
